/*! skrollr-stylesheets 0.0.6 (2014-04-06) | Alexander Prinzhorn - https://github.com/Prinzhorn/skrollr-stylesheets | Free to use under terms of MIT license */
define(["skrollr"],function(a){"use strict";function b(){for(var a,b=document.body.querySelectorAll("*"),c=[],d=0,e=b.length;e>d;d++){a=b[d];for(var f=0;f<a.attributes.length;f++){var g=a.attributes[f];/data-[0-9]+/.test(g.name)&&c.push(g.name)}for(f=0;f<c.length;f++)a.removeAttribute(c[f])}}function c(a,b){for(var c,d,e,f,g,h,i,j=[],k={},l="data-"+n+"-"+b,m=0,o=a.length;o>m;m++)if(c=a[m],"1"==b.charAt(m)){j=j.concat(c.selectors);for(var p in c.animations)c.animations.hasOwnProperty(p)&&(k[p]=c.animations[p])}for(var q=0,r=j.length;r>q;q++)if(d=j[q],e=document.querySelectorAll(d[0])){h=k[d[1]];for(var s=0,t=e.length;t>s;s++){f=e[s],g=JSON.parse(f.getAttribute(l)||"{}");for(i in h)";"!=h[i].charAt(h[i].length-1)&&(h[i]+=";"),g[i]=g[i]?h[i]+g[i]:h[i];f.setAttribute(l,JSON.stringify(g))}}}function d(a){var b,c="";if(!matchMedia)return e("1",a.length);for(var d=0,f=a.length;f>d;d++)b=a[d],c=c.concat(!b.media||matchMedia(b.media).matches?"1":"0");return c}function e(a,b){var c="";if(1>b)return c;for(;b>0;)1&b&&(c+=a),b>>=1,a+=a;return c}function f(a){a=a.trim();for(var b=(";"==a.charAt(a.length-1)?a.substring(0,a.length-1):a).split(";"),c=[],d=0,e=b.length;e>d;d++)c.push(b[d].split(":")[0]);return c}function g(){u(!0)}var h,i,j=[],k=30,l="",m={},n="ss",o=/@-skrollr-keyframes\s+([\w-]+)/g,p=/\s*\{\s*((?:[^{]+\{[^}]*\}\s*)+?)\s*\}/g,q=/([\w\-]+)\s*\{([^}]+)\}/g,r=/-skrollr-animation-name\s*:\s*([\w-]+)/g,s=function(a){var b=new XMLHttpRequest;try{b.open("GET",a,!1),b.send(null)}catch(c){window.XDomainRequest&&(b=new XDomainRequest,b.open("GET",a,!1),b.send(null))}return b.responseText},t=function(a){for(var b=0,c=a.length;c>b;b++){var d,e=a[b];if("LINK"===e.tagName){if(null===e.getAttribute("data-skrollr-stylesheet"))continue;d=s(e.href)}else d=e.textContent||e.innerText||e.innerHTML;d&&j.push({content:d,media:e.getAttribute("media"),animations:{},selectors:[]})}j.reverse();for(var f=0;f<j.length;f++)d=j[f].content,v(d,j[f].animations),w(d,j[f].selectors);u(!1)},u=function(e){var f,g=(new Date).getTime();return e&&h&&k>g-h?(window.clearTimeout(i),void(i=window.setTimeout(u,k))):(h=g,f=d(j),void(f!==l&&(b(),m[f]||(c(j,f),m[f]=!0),x(f),(a.get()||a.init()).refresh(),l=f)))},v=function(a,b){o.lastIndex=0;for(var c,d,e,f;null!==(c=o.exec(a));)for(p.lastIndex=o.lastIndex,d=p.exec(a),q.lastIndex=0,f=b[c[1]]={};null!==(e=q.exec(d[1]));)f[e[1]]=e[2].replace(/[\n\r\t]/g,"")},w=function(a,b){r.lastIndex=0;for(var c,d,e;null!==(c=r.exec(a));){for(e=r.lastIndex;e--&&"{"!==a.charAt(e););for(d=e;d--&&"}"!==a.charAt(d-1););b.push([a.substring(d,e).replace(/[\n\r\t]/g,""),c[1]])}},x=function(b){for(var c,d="data-"+n+"-"+b,e="data-"+n+"-"+l,g=document.querySelectorAll("["+d+"], ["+e+"]"),h=function(b){a.setStyle(c,b,"")},i=function(a){return a.replace(/\[.*\]/,"")},j=0,k=g.length;k>j;j++){c=g[j];var m=JSON.parse(c.getAttribute(d))||{};for(var o in m)c.setAttribute("data-"+o,m[o]);var p=JSON.parse(c.getAttribute(e))||{};for(var q in p)f(p[q]).map(i).forEach(h)}};return{init:function(){t(document.querySelectorAll("link, style")),window.addEventListener?window.addEventListener("resize",g,!1):window.attachEvent&&window.attachEvent("onresize",g)}}});